<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <title>áƒáƒ’áƒ áƒ áƒ›áƒáƒ¦áƒáƒ–áƒ˜áƒ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .product-img { height: 200px; object-fit: cover; border-top-left-radius: 10px; border-top-right-radius: 10px; }
        .cart-box { position: sticky; top: 20px; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .admin-box { background: #e9ecef; padding: 20px; border-radius: 10px; margin-bottom: 30px; border: 1px dashed #ced4da; }
    </style>
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-success mb-4">
    <div class="container">
        <a class="navbar-brand" href="/">ğŸ”™ áƒ™áƒáƒ¢áƒ”áƒ’áƒáƒ áƒ˜áƒ”áƒ‘áƒ–áƒ” áƒ“áƒáƒ‘áƒ áƒ£áƒœáƒ”áƒ‘áƒ</a>
        <span class="navbar-text text-white fw-bold">áƒ™áƒáƒ¢áƒ”áƒ’áƒáƒ áƒ˜áƒ: {{ current_cat }}</span>
    </div>
</nav>

<div class="container">
    <div class="row">
        <div class="col-lg-8">



            <div class="row g-3">
                {% if products|length == 0 %}
                    <div class="alert alert-warning text-center">áƒáƒ› áƒ™áƒáƒ¢áƒ”áƒ’áƒáƒ áƒ˜áƒáƒ¨áƒ˜ áƒáƒ áƒáƒ“áƒ£áƒ¥áƒ¢áƒ”áƒ‘áƒ˜ áƒ¯áƒ”áƒ  áƒáƒ  áƒáƒ áƒ˜áƒ¡.</div>
                {% endif %}

                {% for p in products %}
                <div class="col-md-6">
                    <div class="card h-100 shadow-sm border-0">
                        <img src="{{ p.img }}" class="product-img card-img-top" alt="img" onerror="this.src='https://via.placeholder.com/300'">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <h5 class="card-title">{{ p.name }}</h5>
                                <span class="badge bg-success align-self-start">â‚¾{{ p.price }}</span>
                            </div>
                            <span class="badge bg-secondary mb-2">{{ p.category }}</span>
                            <p class="card-text text-muted small">{{ p.desc }}</p>

                            <div class="d-flex gap-2 mt-3">
                                <button onclick="addToCart('{{ p.name }}', {{ p.price }})" class="btn btn-outline-success btn-sm flex-grow-1">ğŸ›’ áƒ™áƒáƒšáƒáƒ—áƒ</button>
                                <button onclick="deleteProduct({{ p.id }})" class="btn btn-outline-danger btn-sm">ğŸ—‘ áƒ¬áƒáƒ¨áƒšáƒ</button>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="col-lg-4">
            <div class="cart-box">
                <h4 class="d-flex justify-content-between align-items-center mb-3">
                    <span class="text-success">ğŸ›’ áƒ™áƒáƒšáƒáƒ—áƒ</span>
                    <span class="badge bg-success rounded-pill" id="cart-count">0</span>
                </h4>
                <ul class="list-group mb-3" id="cart-items">
                    <li class="list-group-item text-center text-muted">áƒªáƒáƒ áƒ˜áƒ”áƒšáƒ˜áƒ</li>
                </ul>
                <li class="list-group-item d-flex justify-content-between bg-white fw-bold">
                    <span>áƒ¡áƒ£áƒš:</span>
                    <span id="cart-total">â‚¾0.00</span>
                </li>
                <button class="btn btn-primary w-100 mt-3" onclick="alert('áƒ¨áƒ”áƒ™áƒ•áƒ”áƒ—áƒ áƒ’áƒáƒ˜áƒ’áƒ–áƒáƒ•áƒœáƒ!')">áƒ§áƒ˜áƒ“áƒ•áƒ˜áƒ¡ áƒ“áƒáƒ¡áƒ áƒ£áƒšáƒ”áƒ‘áƒ</button>
            </div>
        </div>
    </div>
</div>

<script>
    // --- áƒ™áƒáƒšáƒáƒ—áƒ˜áƒ¡ áƒšáƒáƒ’áƒ˜áƒ™áƒ (áƒ›áƒ£áƒ¨áƒáƒáƒ‘áƒ¡ áƒ‘áƒ áƒáƒ£áƒ–áƒ”áƒ áƒ¨áƒ˜) ---
    let cart = [];

    function addToCart(name, price) {
        cart.push({name, price});
        renderCart();
    }

    function removeFromCart(index) {
        cart.splice(index, 1);
        renderCart();
    }

    function renderCart() {
        const list = document.getElementById('cart-items');
        const totalEl = document.getElementById('cart-total');
        const countEl = document.getElementById('cart-count');

        list.innerHTML = '';
        let total = 0;

        cart.forEach((item, index) => {
            total += item.price;
            list.innerHTML += `
                <li class="list-group-item d-flex justify-content-between lh-sm">
                    <div><small>${item.name}</small></div>
                    <span class="text-muted">â‚¾${item.price}
                        <span class="text-danger" style="cursor:pointer; margin-left:5px;" onclick="removeFromCart(${index})">&times;</span>
                    </span>
                </li>`;
        });

        if(cart.length === 0) list.innerHTML = '<li class="list-group-item text-center text-muted">áƒªáƒáƒ áƒ˜áƒ”áƒšáƒ˜áƒ</li>';

        totalEl.innerText = 'â‚¾' + total.toFixed(2);
        countEl.innerText = cart.length;
    }

    // --- áƒ‘áƒáƒ–áƒáƒ¡áƒ—áƒáƒœ áƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ˜ (API) ---

    function addProduct() {
        const name = document.getElementById('pName').value;
        const price = document.getElementById('pPrice').value;
        const cat = document.getElementById('pCat').value;
        const img = document.getElementById('pImg').value || 'https://via.placeholder.com/300';
        const desc = document.getElementById('pDesc').value;

        if(!name || !price) return alert("áƒ¨áƒ”áƒáƒ•áƒ¡áƒ”áƒ— áƒ¡áƒáƒ®áƒ”áƒšáƒ˜ áƒ“áƒ áƒ¤áƒáƒ¡áƒ˜!");

        fetch('/add', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                name: name,
                price: price,
                category: cat,
                img: img,
                desc: desc
            })
        }).then(res => res.json()).then(data => {
            if(data.success) location.reload();
        });
    }

    function deleteProduct(id) {
        if(confirm('áƒ¬áƒáƒ•áƒ¨áƒáƒšáƒ áƒ‘áƒáƒ–áƒ˜áƒ“áƒáƒœ?')) {
            fetch('/delete/' + id, { method: 'DELETE' })
            .then(res => res.json())
            .then(data => {
                if(data.success) location.reload();
            });
        }
    }
</script>

</body>
</html>