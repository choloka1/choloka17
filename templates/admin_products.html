<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>პროდუქტების მართვა | AgroShop Admin</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body, html {
            height: 100%;
            margin: 0;
            font-family: 'Montserrat', sans-serif;
            background-color: #f3f4f6;
        }

        .admin-bg-container {
            background-image: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)),
                              url("{{ url_for('static', filename='agroshop.jpg') }}");
            min-height: 100vh;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
            background-attachment: fixed;
            padding: 50px 20px;
        }

        .admin-glass-card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(15px);
            border-radius: 35px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            padding: 40px;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
        }

        .page-header h2 { font-weight: 700; color: #111827; }

        .header-line {
            width: 70px; height: 5px; background: #059669;
            margin: 15px auto; border-radius: 10px;
        }

        /* ცხრილის სტილი */
        .table thead th {
            border: none; color: #6b7280;
            text-transform: uppercase; font-size: 0.75rem;
            letter-spacing: 1px; padding: 15px;
        }

        .table tbody tr {
            background: #ffffff;
            border-bottom: 1px solid #eee;
            transition: background 0.2s;
        }

        .table tbody tr:hover { background: #f9fafb; }

        .product-thumb {
            width: 60px; height: 60px;
            object-fit: cover; border-radius: 12px;
        }

        /* აღწერის კონტეინერი სკროლით */
        .desc-scroll {
            max-width: 200px;
            max-height: 80px;
            overflow-y: auto;
            font-size: 0.85rem;
            line-height: 1.4;
            color: #4b5563;
            white-space: pre-wrap;
            padding-right: 5px;
        }

        .desc-scroll::-webkit-scrollbar { width: 4px; }
        .desc-scroll::-webkit-scrollbar-thumb { background: #059669; border-radius: 10px; }

        /* გამყიდველის ბლოკი */
        .email-badge {
            font-size: 0.8rem;
            color: #2563eb;
            background: rgba(37, 99, 235, 0.1);
            padding: 4px 10px;
            border-radius: 8px;
            font-weight: 500;
            display: inline-block;
        }

        /* კომენტარის გრაფა */
        .feedback-input {
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            padding: 8px 12px;
            font-size: 0.8rem;
            width: 100%;
            min-width: 180px;
            resize: none;
            transition: 0.3s;
        }

        .feedback-input:focus {
            outline: none;
            border-color: #059669;
            box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1);
        }

        /* ღილაკების სტილი */
        .btn-action {
            padding: 8px; border-radius: 10px;
            font-weight: 600; transition: 0.3s;
            display: inline-flex; align-items: center; justify-content: center;
            border: none; width: 38px; height: 38px;
        }

        .btn-approve { background: #dcfce7; color: #166534; }
        .btn-approve:hover { background: #16a34a; color: white; }

        .btn-reject { background: #fee2e2; color: #991b1b; }
        .btn-reject:hover { background: #dc2626; color: white; }
    </style>
</head>
<body>

<div class="admin-bg-container">
    <div class="admin-glass-card shadow">
        <div class="page-header text-center mb-4">
            <h2><i class="fas fa-user-shield me-2 text-success"></i> ადმინ პანელი</h2>
            <div class="header-line"></div>
            <p class="text-muted">პროდუქტების ვერიფიკაცია და უკუკავშირი</p>
        </div>

        {% if products %}
        <div class="table-responsive">
            <table class="table align-middle">
                <thead>
                    <tr>
                        <th>პროდუქტი</th>
                        <th>გამყიდველი</th>
                        <th>ფასი</th>
                        <th>კატეგორია</th>
                        <th>აღწერა</th>
                        <th class="text-center" style="width: 250px;">მოქმედება & უკუკავშირი</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in products %}
                    <tr>
                        <td>
                            <div class="d-flex align-items-center gap-3">
                                <img src="{{ product.img }}" alt="img" class="product-thumb shadow-sm">
                                <div class="fw-bold text-dark">{{ product.name }}</div>
                            </div>
                        </td>

                        <td>
                            <div class="d-flex flex-column">
                                {% if product.seller %}
                                    <span class="email-badge mb-1">
                                        <i class="far fa-envelope me-1"></i> {{ product.seller.email }}
                                    </span>
                                    <small class="text-dark fw-bold">
                                        <i class="fas fa-user me-1"></i> {{ product.seller.name }} {{ product.seller.surname }}
                                    </small>
                                    <small class="text-muted">
                                        <i class="fas fa-map-marker-alt me-1"></i> {{ product.seller.city }}
                                    </small>
                                {% else %}
                                    <span class="badge bg-secondary">უცნობი გამყიდველი</span>
                                {% endif %}
                            </div>
                        </td>

                        <td><span class="text-success fw-bold">{{ product.price }} ₾</span></td>
                        <td><span class="badge bg-light text-dark border">{{ product.category }}</span></td>

                        <td>
                            <div class="desc-scroll">
                                {{ product.desc }}
                            </div>
                        </td>

                        <td class="text-center">
                            <form action="{{ url_for('process_product', product_id=product.id) }}" method="POST">
                                <textarea name="feedback" class="feedback-input mb-2" rows="2"
                                          placeholder="მიწერეთ მიზეზი..."></textarea>

                                <div class="d-flex justify-content-center gap-2">
                                    <button type="submit" name="status" value="approve" class="btn-action btn-approve" title="დადასტურება">
                                        <i class="fas fa-check"></i>
                                    </button>

                                    <button type="submit" name="status" value="reject" class="btn-action btn-reject"
                                            onclick="return confirm('ნამდვილად გსურთ უარყოფა?')" title="უარყოფა">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-center py-5">
            <i class="fas fa-check-circle fa-4x text-muted mb-3 opacity-25"></i>
            <h4 class="text-muted">ამჟამად ახალი მოთხოვნები არ არის</h4>
        </div>
        {% endif %}

        <div class="text-center mt-4">
            <a href="/add/panel" class="btn btn-outline-dark px-5 rounded-pill fw-bold">
                <i class="fas fa-arrow-left me-2"></i> დაბრუნება
            </a>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>